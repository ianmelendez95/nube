{
    "Parameters": {
        "CapitalizeTwoWordsBucket": {
            "Default": "capitalizetwowords-bucket",
            "Type": "String"
        }
    },
    "Resources": {
        "CapitalizeTwoWordsApi": {
            "Properties": {
                "Name": "capitalizeTwoWords-api",
                "ProtocolType": "HTTP"
            },
            "Type": "AWS::ApiGatewayV2::Api"
        },
        "CapitalizeTwoWordsApiStage": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "AutoDeploy": true,
                "StageName": "$default"
            },
            "Type": "AWS::ApiGatewayV2::Stage"
        },
        "CapitalizeTwoWordsC1Integration": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "IntegrationMethod": "POST",
                "IntegrationType": "AWS_PROXY",
                "IntegrationUri": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC1Lambda.Arn"
                },
                "PayloadFormatVersion": "2.0"
            },
            "Type": "AWS::ApiGatewayV2::Integration"
        },
        "CapitalizeTwoWordsC1Lambda": {
            "Properties": {
                "Code": {
                    "S3Bucket": {
                        "Ref": "CapitalizeTwoWordsBucket"
                    },
                    "S3Key": "capitalizeTwoWordsC1-code.zip"
                },
                "Environment": {
                    "Variables": {
                        "SQS_BASE_URL": {
                            "Fn::Sub": "https://sqs.${AWS::Region}.amazonaws.com/${AWS::AccountId}"
                        }
                    }
                },
                "FunctionName": "capitalizeTwoWordsC1",
                "Handler": "index.handler",
                "Layers": [
                    {
                        "Ref": "CapitalizeTwoWordsLayer"
                    }
                ],
                "Role": {
                    "Fn::GetAtt": "CapitalizeTwoWordsRole.Arn"
                },
                "Runtime": "nodejs22.x",
                "Timeout": 20
            },
            "Type": "AWS::Lambda::Function"
        },
        "CapitalizeTwoWordsC1Permission": {
            "Properties": {
                "Action": "lambda:InvokeFunction",
                "FunctionName": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC1Lambda.Arn"
                },
                "Principal": "apigateway.amazonaws.com",
                "SourceArn": {
                    "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${CapitalizeTwoWordsApi}/${CapitalizeTwoWordsApiStage}/POST/capitalizeTwoWordsC1"
                }
            },
            "Type": "AWS::Lambda::Permission"
        },
        "CapitalizeTwoWordsC1RequestQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWordsC1-request-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsC1ResponseQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWordsC1-response-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsC1Route": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "RouteKey": "POST /capitalizeTwoWordsC1",
                "Target": {
                    "Fn::Sub": "integrations/${CapitalizeTwoWordsC1Integration}"
                }
            },
            "Type": "AWS::ApiGatewayV2::Route"
        },
        "CapitalizeTwoWordsC1SQSMapping": {
            "Properties": {
                "BatchSize": 10,
                "EventSourceArn": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC1RequestQueue.Arn"
                },
                "FunctionName": {
                    "Ref": "CapitalizeTwoWordsC1Lambda"
                },
                "MaximumBatchingWindowInSeconds": 5
            },
            "Type": "AWS::Lambda::EventSourceMapping"
        },
        "CapitalizeTwoWordsC2Integration": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "IntegrationMethod": "POST",
                "IntegrationType": "AWS_PROXY",
                "IntegrationUri": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC2Lambda.Arn"
                },
                "PayloadFormatVersion": "2.0"
            },
            "Type": "AWS::ApiGatewayV2::Integration"
        },
        "CapitalizeTwoWordsC2Lambda": {
            "Properties": {
                "Code": {
                    "S3Bucket": {
                        "Ref": "CapitalizeTwoWordsBucket"
                    },
                    "S3Key": "capitalizeTwoWordsC2-code.zip"
                },
                "Environment": {
                    "Variables": {
                        "SQS_BASE_URL": {
                            "Fn::Sub": "https://sqs.${AWS::Region}.amazonaws.com/${AWS::AccountId}"
                        }
                    }
                },
                "FunctionName": "capitalizeTwoWordsC2",
                "Handler": "index.handler",
                "Layers": [
                    {
                        "Ref": "CapitalizeTwoWordsLayer"
                    }
                ],
                "Role": {
                    "Fn::GetAtt": "CapitalizeTwoWordsRole.Arn"
                },
                "Runtime": "nodejs22.x",
                "Timeout": 20
            },
            "Type": "AWS::Lambda::Function"
        },
        "CapitalizeTwoWordsC2Permission": {
            "Properties": {
                "Action": "lambda:InvokeFunction",
                "FunctionName": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC2Lambda.Arn"
                },
                "Principal": "apigateway.amazonaws.com",
                "SourceArn": {
                    "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${CapitalizeTwoWordsApi}/${CapitalizeTwoWordsApiStage}/POST/capitalizeTwoWordsC2"
                }
            },
            "Type": "AWS::Lambda::Permission"
        },
        "CapitalizeTwoWordsC2RequestQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWordsC2-request-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsC2ResponseQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWordsC2-response-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsC2Route": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "RouteKey": "POST /capitalizeTwoWordsC2",
                "Target": {
                    "Fn::Sub": "integrations/${CapitalizeTwoWordsC2Integration}"
                }
            },
            "Type": "AWS::ApiGatewayV2::Route"
        },
        "CapitalizeTwoWordsC2SQSMapping": {
            "Properties": {
                "BatchSize": 10,
                "EventSourceArn": {
                    "Fn::GetAtt": "CapitalizeTwoWordsC2RequestQueue.Arn"
                },
                "FunctionName": {
                    "Ref": "CapitalizeTwoWordsC2Lambda"
                },
                "MaximumBatchingWindowInSeconds": 5
            },
            "Type": "AWS::Lambda::EventSourceMapping"
        },
        "CapitalizeTwoWordsIntegration": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "IntegrationMethod": "POST",
                "IntegrationType": "AWS_PROXY",
                "IntegrationUri": {
                    "Fn::GetAtt": "CapitalizeTwoWordsLambda.Arn"
                },
                "PayloadFormatVersion": "2.0"
            },
            "Type": "AWS::ApiGatewayV2::Integration"
        },
        "CapitalizeTwoWordsLambda": {
            "Properties": {
                "Code": {
                    "S3Bucket": {
                        "Ref": "CapitalizeTwoWordsBucket"
                    },
                    "S3Key": "capitalizeTwoWords-code.zip"
                },
                "Environment": {
                    "Variables": {
                        "SQS_BASE_URL": {
                            "Fn::Sub": "https://sqs.${AWS::Region}.amazonaws.com/${AWS::AccountId}"
                        }
                    }
                },
                "FunctionName": "capitalizeTwoWords",
                "Handler": "index.handler",
                "Layers": [
                    {
                        "Ref": "CapitalizeTwoWordsLayer"
                    }
                ],
                "Role": {
                    "Fn::GetAtt": "CapitalizeTwoWordsRole.Arn"
                },
                "Runtime": "nodejs22.x",
                "Timeout": 20
            },
            "Type": "AWS::Lambda::Function"
        },
        "CapitalizeTwoWordsLayer": {
            "Properties": {
                "CompatibleArchitectures": [
                    "x86_64"
                ],
                "CompatibleRuntimes": [
                    "nodejs22.x"
                ],
                "Content": {
                    "S3Bucket": {
                        "Ref": "CapitalizeTwoWordsBucket"
                    },
                    "S3Key": "capitalizeTwoWords-layer.zip"
                },
                "LayerName": "capitalizeTwoWords-layer"
            },
            "Type": "AWS::Lambda::LayerVersion"
        },
        "CapitalizeTwoWordsPermission": {
            "Properties": {
                "Action": "lambda:InvokeFunction",
                "FunctionName": {
                    "Fn::GetAtt": "CapitalizeTwoWordsLambda.Arn"
                },
                "Principal": "apigateway.amazonaws.com",
                "SourceArn": {
                    "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${CapitalizeTwoWordsApi}/${CapitalizeTwoWordsApiStage}/POST/capitalizeTwoWords"
                }
            },
            "Type": "AWS::Lambda::Permission"
        },
        "CapitalizeTwoWordsRequestQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWords-request-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsResponseQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeTwoWords-response-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeTwoWordsRole": {
            "Properties": {
                "AssumeRolePolicyDocument": {
                    "Statement": [
                        {
                            "Action": "sts:AssumeRole",
                            "Effect": "Allow",
                            "Principal": {
                                "Service": "lambda.amazonaws.com"
                            }
                        }
                    ],
                    "Version": "2012-10-17"
                },
                "ManagedPolicyArns": [
                    "arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole",
                    "arn:aws:iam::aws:policy/service-role/AWSLambdaSQSQueueExecutionRole"
                ],
                "MaxSessionDuration": 3600,
                "Path": "/service-role/",
                "Policies": [
                    {
                        "PolicyDocument": {
                            "Statement": [
                                {
                                    "Action": [
                                        "sqs:SendMessage"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": {
                                        "Fn::Sub": "arn:aws:sqs:${AWS::Region}:${AWS::AccountId}:*-queue"
                                    }
                                },
                                {
                                    "Action": [
                                        "dynamodb:PutItem",
                                        "dynamodb:GetItem",
                                        "dynamodb:UpdateItem",
                                        "dynamodb:DeleteItem",
                                        "dynamodb:Query"
                                    ],
                                    "Effect": "Allow",
                                    "Resource": [
                                        {
                                            "Fn::GetAtt": "FrameTable.Arn"
                                        },
                                        {
                                            "Fn::GetAtt": "ResultTable.Arn"
                                        }
                                    ]
                                }
                            ],
                            "Version": "2012-10-17"
                        },
                        "PolicyName": "SQSAndDynamoPolicy"
                    }
                ],
                "RoleName": "capitalizeTwoWords-role"
            },
            "Type": "AWS::IAM::Role"
        },
        "CapitalizeTwoWordsRoute": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "RouteKey": "POST /capitalizeTwoWords",
                "Target": {
                    "Fn::Sub": "integrations/${CapitalizeTwoWordsIntegration}"
                }
            },
            "Type": "AWS::ApiGatewayV2::Route"
        },
        "CapitalizeTwoWordsSQSMapping": {
            "Properties": {
                "BatchSize": 10,
                "EventSourceArn": {
                    "Fn::GetAtt": "CapitalizeTwoWordsRequestQueue.Arn"
                },
                "FunctionName": {
                    "Ref": "CapitalizeTwoWordsLambda"
                },
                "MaximumBatchingWindowInSeconds": 5
            },
            "Type": "AWS::Lambda::EventSourceMapping"
        },
        "CapitalizeWordIntegration": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "IntegrationMethod": "POST",
                "IntegrationType": "AWS_PROXY",
                "IntegrationUri": {
                    "Fn::GetAtt": "CapitalizeWordLambda.Arn"
                },
                "PayloadFormatVersion": "2.0"
            },
            "Type": "AWS::ApiGatewayV2::Integration"
        },
        "CapitalizeWordLambda": {
            "Properties": {
                "Code": {
                    "S3Bucket": {
                        "Ref": "CapitalizeTwoWordsBucket"
                    },
                    "S3Key": "capitalizeWord-code.zip"
                },
                "Environment": {
                    "Variables": {
                        "SQS_BASE_URL": {
                            "Fn::Sub": "https://sqs.${AWS::Region}.amazonaws.com/${AWS::AccountId}"
                        }
                    }
                },
                "FunctionName": "capitalizeWord",
                "Handler": "index.handler",
                "Layers": [
                    {
                        "Ref": "CapitalizeTwoWordsLayer"
                    }
                ],
                "Role": {
                    "Fn::GetAtt": "CapitalizeTwoWordsRole.Arn"
                },
                "Runtime": "nodejs22.x",
                "Timeout": 20
            },
            "Type": "AWS::Lambda::Function"
        },
        "CapitalizeWordPermission": {
            "Properties": {
                "Action": "lambda:InvokeFunction",
                "FunctionName": {
                    "Fn::GetAtt": "CapitalizeWordLambda.Arn"
                },
                "Principal": "apigateway.amazonaws.com",
                "SourceArn": {
                    "Fn::Sub": "arn:aws:execute-api:${AWS::Region}:${AWS::AccountId}:${CapitalizeTwoWordsApi}/${CapitalizeTwoWordsApiStage}/POST/capitalizeWord"
                }
            },
            "Type": "AWS::Lambda::Permission"
        },
        "CapitalizeWordRequestQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeWord-request-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeWordResponseQueue": {
            "Properties": {
                "MessageRetentionPeriod": 60,
                "QueueName": "capitalizeWord-response-queue",
                "ReceiveMessageWaitTimeSeconds": 5,
                "VisibilityTimeout": 20
            },
            "Type": "AWS::SQS::Queue"
        },
        "CapitalizeWordRoute": {
            "Properties": {
                "ApiId": {
                    "Ref": "CapitalizeTwoWordsApi"
                },
                "RouteKey": "POST /capitalizeWord",
                "Target": {
                    "Fn::Sub": "integrations/${CapitalizeWordIntegration}"
                }
            },
            "Type": "AWS::ApiGatewayV2::Route"
        },
        "CapitalizeWordSQSMapping": {
            "Properties": {
                "BatchSize": 10,
                "EventSourceArn": {
                    "Fn::GetAtt": "CapitalizeWordRequestQueue.Arn"
                },
                "FunctionName": {
                    "Ref": "CapitalizeWordLambda"
                },
                "MaximumBatchingWindowInSeconds": 5
            },
            "Type": "AWS::Lambda::EventSourceMapping"
        },
        "FrameTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "frameId",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "KeySchema": [
                    {
                        "AttributeName": "frameId",
                        "KeyType": "HASH"
                    }
                ],
                "TableClass": "STANDARD",
                "TableName": "frame-table"
            },
            "Type": "AWS::DynamoDB::Table"
        },
        "ResultTable": {
            "Properties": {
                "AttributeDefinitions": [
                    {
                        "AttributeName": "frameId",
                        "AttributeType": "S"
                    }
                ],
                "BillingMode": "PAY_PER_REQUEST",
                "KeySchema": [
                    {
                        "AttributeName": "frameId",
                        "KeyType": "HASH"
                    }
                ],
                "TableClass": "STANDARD",
                "TableName": "result-table"
            },
            "Type": "AWS::DynamoDB::Table"
        }
    }
}